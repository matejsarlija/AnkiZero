# End-to-End (E2E) Manual Testing Plan for AnkiZero

## 1. Introduction

This document outlines manual End-to-End (E2E) test cases for the AnkiZero application. The purpose of these tests is to verify that complete user flows, combining multiple features, work as expected from the user's perspective. These tests are intended to be executed manually on a physical device or emulator.

## 2. Prerequisites

*   **App Installation:** A recent debug or release build of the AnkiZero application installed on the test device/emulator.
*   **Firebase Setup (for Analytics/Crashlytics tests):** The installed build should be configured with a valid `google-services.json` pointing to a Firebase project where testers can access Analytics DebugView and the Crashlytics dashboard.
*   **Device/Emulator State:**
    *   Internet connectivity for Firebase reporting.
    *   Ability to manipulate device time for testing notification scheduling (if possible and safe for the test environment).
    *   Access to device camera and image gallery for OCR testing.
*   **Tools:**
    *   Android Studio's App Inspection (for direct database verification, optional but helpful).
    *   `adb` for enabling Firebase Analytics DebugView.

## 3. Test Cases

For each test case, follow the steps and verify the expected results. Mark Pass/Fail accordingly.

---

### Flow 1: Full Flashcard Lifecycle and Review

#### Scenario 1.1: Create via OCR, Review, Edit, and Verify SRS

*   **Objective:** Test the creation of a card via OCR, its initial review, subsequent editing, and basic SRS behavior.
*   **Preconditions:** OCR screen is functional; navigation between screens is working.

| Step                                                                 | Action                                                                                                                               | Expected Result                                                                                                                                  | Pass/Fail | Notes/Observations |
| :------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------- | :-------- | :----------------- |
| 1.1.1                                                                | Navigate to the OCR screen.                                                                                                          | OCR screen with camera preview (or permission request if first time) is displayed.                                                                 |           |                    |
| 1.1.2                                                                | Use "Import from Gallery" to select an image with clear French text (e.g., "chien - dog"). (Or use Camera Capture).                | Image is processed (loading indicator may appear). Recognized Text Dialog appears with extracted text (e.g., "chien - dog").                     |           |                    |
| 1.1.3                                                                | Edit the text if needed to ensure distinct French and English parts. E.g., French: "Chien", English: "Dog".                          | Text field updates as expected.                                                                                                                   |           |                    |
| 1.1.4                                                                | Tap "Save" in the dialog.                                                                                                            | Dialog closes. Card is created. (App may navigate away or OCR screen resets).                                                                     |           |                    |
| 1.1.5                                                                | Navigate to the Card Management screen.                                                                                              | The newly created card (e.g., "Chien") is visible in the list.                                                                                     |           |                    |
| 1.1.6                                                                | (DB Check - Optional) Use App Inspection to verify the card "Chien" exists in `flashcard_table` with default SRS values (e.g., interval ~1.0, easeFactor ~2.5, nextReviewDate is current time). | Card data is correct in DB.                                                                                                                      |           |                    |
| 1.1.7                                                                | Navigate to the Flashcard Review screen.                                                                                             | The "Chien" card (or another due card) is presented for review. If multiple new cards, "Chien" should be among them.                               |           |                    |
| 1.1.8                                                                | Assuming "Chien" is shown, tap "Memorized".                                                                                          | Card is processed. UI updates to next card or "No cards due" state.                                                                                |           |                    |
| 1.1.9                                                                | (DB Check - Optional) Verify "Chien" card in DB: `nextReviewDate` is in the future (e.g., ~1.8 days from now), `intervalInDays` increased, `easeFactor` increased slightly, `reviewCount` is 1. | SRS parameters updated correctly for "Memorized".                                                                                               |           |                    |
| 1.1.10                                                               | Navigate to Card Management. Find and tap the "Chien" card to open Edit Card screen.                                                 | Edit Card screen opens with "Chien" card details populated.                                                                                      |           |                    |
| 1.1.11                                                               | Modify the "Notes" field (e.g., add "A common pet"). Tap "Save".                                                                      | User returns to Card Management.                                                                                                                 |           |                    |
| 1.1.12                                                               | Re-open the "Chien" card for editing or view its details.                                                                            | The "Notes" field shows "A common pet". Other fields (especially SRS params) should be unchanged from step 1.1.9.                                |           |                    |

---

#### Scenario 1.2: Create Manually, Review with SRS ("No" then "Memorized")

*   **Objective:** Test manual card creation and SRS progression, particularly the "No" path and subsequent "Memorized" path.
*   **Preconditions:** Navigation is working.

| Step                                                                 | Action                                                                                                                                  | Expected Result                                                                                                                                   | Pass/Fail | Notes/Observations |
| :------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------ | :-------- | :----------------- |
| 1.2.1                                                                | Navigate to Card Management, tap FAB (+).                                                                                                 | Create Card screen opens.                                                                                                                           |           |                    |
| 1.2.2                                                                | Input: French Word="Chat", English Translation="Cat", Pronunciation="sha", Example="Le chat est gris", Notes="Feline", Difficulty=2. Save. | Card is saved. Navigated back to Card Management. "Chat" card appears in the list.                                                                  |           |                    |
| 1.2.3                                                                | (DB Check - Optional) Verify "Chat" card in DB with correct input and default SRS values.                                                | Card data correct.                                                                                                                                  |           |                    |
| 1.2.4                                                                | Navigate to Flashcard Review. "Chat" card should appear.                                                                                  | "Chat" card is displayed.                                                                                                                           |           |                    |
| 1.2.5                                                                | Tap "No".                                                                                                                               | Card processed. UI updates.                                                                                                                         |           |                    |
| 1.2.6                                                                | (DB Check - Optional) Verify "Chat" card: `nextReviewDate` is tomorrow (or +1 day interval), `intervalInDays` is 1.0, `easeFactor` decreased (min 1.3), `reviewCount` is 1. | SRS parameters updated correctly for "No".                                                                                                       |           |                    |
| 1.2.7                                                                | (Requires ability to advance device time or wait) Advance device time by 1 day. Or, if other cards are due, review them. Re-launch app.      |                                                                                                                                                   |           | Forcing card due  |
| 1.2.8                                                                | Navigate to Flashcard Review. "Chat" card should appear again.                                                                            | "Chat" card is displayed for review.                                                                                                                |           |                    |
| 1.2.9                                                                | Tap "Memorized".                                                                                                                        | Card processed. UI updates.                                                                                                                         |           |                    |
| 1.2.10                                                               | (DB Check - Optional) Verify "Chat" card: `nextReviewDate` is now further in the future (e.g., original_interval_after_"No" * 1.8), `intervalInDays` increased, `easeFactor` increased, `reviewCount` is 2. | SRS parameters updated correctly for subsequent "Memorized".                                                                                    |           |                    |

---

### Flow 2: Card Management Deep Dive

#### Scenario 2.1: Search, Sort, Batch Delete

*   **Objective:** Test comprehensive card management functionalities.
*   **Preconditions:** At least 5-6 flashcards with varied content exist. Create them manually if needed (e.g., CardA, CardB_SearchMe, CardC, CardD_SearchMe, CardE).

| Step                                                              | Action                                                                                                                               | Expected Result                                                                                                                                                              | Pass/Fail | Notes/Observations |
| :---------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------- | :----------------- |
| 2.1.1                                                             | Navigate to Card Management screen.                                                                                                  | All existing cards are listed (default sort: Recent).                                                                                                                        |           |                    |
| 2.1.2                                                             | In the search bar, type a term that matches some but not all cards (e.g., "SearchMe" if you created CardB_SearchMe, CardD_SearchMe). | The list dynamically filters to show only matching cards (CardB_SearchMe, CardD_SearchMe).                                                                                   |           |                    |
| 2.1.3                                                             | Clear the search bar.                                                                                                                | The list reverts to showing all cards.                                                                                                                                       |           |                    |
| 2.1.4                                                             | Tap the sort options. Select "Alphabetical".                                                                                         | List re-sorts alphabetically by French word (e.g., CardA, CardB_SearchMe, CardC...).                                                                                         |           |                    |
| 2.1.5                                                             | Tap the sort options. Select "Recent".                                                                                               | List re-sorts by creation date (newest first).                                                                                                                               |           |                    |
| 2.1.6                                                             | Long-press on one card (e.g., CardA) to enter selection mode.                                                                        | CardA is marked as selected (e.g., checkbox appears, background changes). Delete icon appears in TopAppBar.                                                                |           |                    |
| 2.1.7                                                             | Tap two other cards (e.g., CardC, CardE) to add them to selection.                                                                   | CardC and CardE are also marked selected. Delete icon remains visible.                                                                                                     |           |                    |
| 2.1.8                                                             | Tap the Delete icon in the TopAppBar.                                                                                                | A confirmation dialog appears asking to confirm deletion of 3 cards.                                                                                                       |           |                    |
| 2.1.9                                                             | Tap "Confirm" (or "Delete") in the dialog.                                                                                           | The selected cards (CardA, CardC, CardE) are removed from the list. Selection mode is exited. Delete icon in TopAppBar disappears.                                          |           |                    |
| 2.1.10                                                            | (DB Check - Optional) Verify the deleted cards are removed from `flashcard_table`.                                                    | Cards are deleted from DB.                                                                                                                                                   |           |                    |

---

### Flow 3: Notification Preferences and Worker (Conceptual / Future)

*   **Objective:** Test UI for notification preferences and conceptual understanding of worker scheduling. Actual notification appearance is for later, more integrated testing.
*   **Preconditions:** Navigation to Notifications screen is possible.

| Step                                                       | Action                                                                                                                             | Expected Result                                                                                                                                                             | Pass/Fail | Notes/Observations |
| :--------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------- | :----------------- |
| 3.1.1                                                      | Navigate to Notifications screen.                                                                                                  | Notifications screen is displayed. "Enable Daily Reminders" switch and "Reminder Time" are visible. List of (placeholder/actual) due cards is shown.                              |           |                    |
| 3.1.2                                                      | Observe the default state of "Enable Daily Reminders" (e.g., true).                                                                | Switch reflects the default/saved state.                                                                                                                                    |           |                    |
| 3.1.3                                                      | Tap the "Enable Daily Reminders" switch to turn it OFF.                                                                            | Switch state changes to OFF. (ViewModel should log worker cancellation).                                                                                                    |           |                    |
| 3.1.4                                                      | Tap the switch again to turn it ON.                                                                                                | Switch state changes to ON. (ViewModel should log worker scheduling).                                                                                                       |           |                    |
| 3.1.5                                                      | Observe the displayed "Reminder Time" (e.g., "09:00 AM").                                                                          | Static time is displayed as per current implementation.                                                                                                                     |           |                    |
| 3.1.6                                                      | (Future - when time picker is implemented) Tap "Reminder Time", select a new time (e.g., 10:30 AM), confirm.                         | Displayed time updates to "10:30 AM". (ViewModel should log preference change and reschedule worker).                                                                       |           | (Future test)      |
| 3.1.7                                                      | (Future - when worker is fully testable) Ensure reminders are enabled. Advance device time past the set reminder time for next day. | **(Future Expected):** A system notification appears for due cards.                                                                                                           |           | (Future test)      |
| 3.1.8                                                      | (Future) Tap the notification.                                                                                                     | **(Future Expected):** App opens, ideally navigating to the Flashcard Review screen (verifying deep link).                                                                  |           | (Future test)      |
| 3.1.9                                                      | (Future) Disable daily reminders. Advance time again past reminder time.                                                             | **(Future Expected):** No notification appears, confirming worker cancellation.                                                                                               |           | (Future test)      |

---

### Flow 4: Analytics and Crash Reporting E2E Check

*   **Objective:** Verify that key analytics events are logged and crash reports are sent to Firebase during typical user flows.
*   **Preconditions:** Firebase is correctly set up with a valid `google-services.json`. For Crashlytics, ensure collection is enabled for the build type being tested (see `FirebaseVerification.md`). `adb` access for Analytics DebugView.

| Step                                                       | Action                                                                                                                                                                                            | Expected Result                                                                                                                                                           | Pass/Fail | Notes/Observations |
| :--------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-------- | :----------------- |
| 4.1.1                                                      | Enable Firebase Analytics DebugView using `adb shell setprop debug.firebase.analytics.app com.example.ankizero`. Open Firebase Console -> Analytics -> DebugView. Select test device.              | DebugView is active and showing initial events (e.g., `screen_view` for current screen).                                                                                    |           |                    |
| 4.1.2                                                      | **Perform actions from Scenario 1.1 (Create via OCR, Review, Edit):** Steps 1.1.1 through 1.1.12.                                                                                                 | **In DebugView:** Observe `screen_view` for each screen, `ocr_used`, `new_card_saved` (with source "ocr"), `card_reviewed` (with params), `card_updated` events.                  |           |                    |
| 4.1.3                                                      | **Perform actions from Scenario 1.2 (Create Manually, Review):** Steps 1.2.1 through 1.2.6, and 1.2.8-1.2.10.                                                                                      | **In DebugView:** Observe `screen_view`, `new_card_saved` (with source "manual_creation"), multiple `card_reviewed` events with correct parameters. `review_session_completed` if applicable. |           |                    |
| 4.1.4                                                      | **Perform actions from Scenario 2.1 (Search, Sort, Batch Delete):** Steps 2.1.1 through 2.1.9.                                                                                                  | **In DebugView:** Observe `screen_view`, `search` (with `search_term`), `sort_changed` (with `sort_option`), `card_deleted` (with `delete_count`).                               |           |                    |
| 4.1.5                                                      | **Perform actions from Scenario 3.1 (Notification Preferences):** Steps 3.1.1 through 3.1.4 (and 3.1.6 if time picker was implemented).                                                           | **In DebugView:** Observe `notification_preference_changed` events with correct parameters.                                                                               |           |                    |
| 4.1.6                                                      | Disable Analytics DebugView: `adb shell setprop debug.firebase.analytics.app .none.`                                                                                                              | DebugView stops real-time updates for this device.                                                                                                                          |           |                    |
| 4.1.7                                                      | **Induce a Test Crash:** Navigate to the "Test Crash" button (available in DEBUG builds, ensure Crashlytics collection is appropriately set for the build type). Tap the button. App crashes. | App terminates unexpectedly.                                                                                                                                              |           |                    |
| 4.1.8                                                      | Relaunch the AnkiZero app.                                                                                                                                                                        | App opens normally. (Crash report is typically sent on next launch).                                                                                                      |           |                    |
| 4.1.9                                                      | Wait a few minutes (5-10 min). Open Firebase Console -> Crashlytics.                                                                                                                              | A new crash issue for "RuntimeException: Test Crash from AnkiZero App via Button" should appear. Stack trace and custom logs (if any from `GlobalErrorHandler`) are visible. |           |                    |

---

This E2E testing plan covers the main functionalities and their interactions, aiming to ensure the application behaves as expected in realistic usage scenarios.
